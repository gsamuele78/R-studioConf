# ==========================================
# RStudio Docker Deployment Configuration
# ==========================================

# --- Authentication Strategy ---
# Choose 'sssd' or 'samba'. 
# This determines which Dockerfile is built and which Host sockets are mounted.
AUTH_BACKEND=sssd

# --- Network Configuration ---
# The domain name for generating links and Nginx routing.
HOST_DOMAIN=botanical.example.com

# Ports exposed on the Host
HTTP_PORT=80
HTTPS_PORT=443
RSTUDIO_PORT=8787

# --- Application Versions ---
RSTUDIO_VERSION=2023.06.0
R_VERSION=4.3.1

# --- RStudio Runtime Settings ---
# Session timeout in minutes (default: 7 days)
RSESSION_TIMEOUT_MINUTES=10080

# --- SSL Configuration ---
# Absolute paths on the HOST to the SSL certificate and key.
# These will be read-only mounted into the Nginx container.
SSL_CERT_PATH=/etc/ssl/certs/ssl-cert-snakeoil.pem
SSL_KEY_PATH=/etc/ssl/private/ssl-cert-snakeoil.key

# --- Persistence & Storage ---
# Host paths to bind-mount into the container.
# Users will see their Host home directories inside RStudio.
HOST_HOME_DIR=/home
HOST_PROJECT_ROOT=/nfs/home

# --- Web Portal Settings ---
# Subdomains or path prefixes (used by Nginx templates)
RSTUDIO_SUBDOMAIN=rstudio
PORTAL_SUBDOMAIN=portal
IPV6_ENABLED=false

# --- Time Synchronization ---
# Preferred client: chrony, ntp, or systemd-timesyncd
NTP_PREFERRED_CLIENT="chrony"
CHRONY_FALLBACK_POOLS="pool 2.debian.pool.ntp.org iburst"

# ==========================================
# KERBEROS / AD JOINT CONFIGURATION
# ==========================================

# --- Common Settings ---
DEFAULT_AD_DOMAIN_LOWER="personale.dir.unibo.it"
DEFAULT_AD_DOMAIN_UPPER="PERSONALE.DIR.UNIBO.IT"
DEFAULT_AD_ADMIN_USER_EXAMPLE="gianfranco.samuele2@PERSONALE.DIR.UNIBO.IT"
DEFAULT_COMPUTER_OU_BASE="OU=Servizi_Informatici,OU=Dip-BIGEA,OU=Dsa.Auto"
DEFAULT_COMPUTER_OU_CUSTOM_PART="OU=ServerFarm_Navile"
DEFAULT_OS_NAME="Linux"
DEFAULT_SIMPLE_ALLOW_GROUPS="STR968-Informatica,Str00968-biome,Str00968-lifewatch"
DEFAULT_HOME_TEMPLATE="/nfs/home/%U"

# --- Kerberos Realms (UNIBO) ---
DEFAULT_DIR_UNIBO_REALM="DIR.UNIBO.IT"
DEFAULT_DIR_UNIBO_KDC="dcrdir02.dir.unibo.it"
DEFAULT_DIR_UNIBO_ADMIN_SERVER="dcrdir02.dir.unibo.it"

DEFAULT_PERSONALE_UNIBO_REALM="PERSONALE.DIR.UNIBO.IT"
DEFAULT_PERSONALE_UNIBO_KDC="dcrpersonale01.personale.dir.unibo.it"
DEFAULT_PERSONALE_UNIBO_ADMIN_SERVER="dcrpersonale02.personale.dir.unibo.it"

DEFAULT_STUDENTI_UNIBO_REALM="STUDENTI.DIR.UNIBO.IT"
DEFAULT_STUDENTI_UNIBO_KDC="edge.studenti.dir.unibo.it"
DEFAULT_STUDENTI_UNIBO_ADMIN_SERVER="pole.studenti.dir.unibo.it"

# Domain Mappings (Space separated string for .env compatibility)
DEFAULT_DOMAIN_REALM_MAPPINGS=".dir.unibo.it=DIR.UNIBO.IT dir.unibo.it=DIR.UNIBO.IT .personale.dir.unibo.it=PERSONALE.DIR.UNIBO.IT personale.dir.unibo.it=PERSONALE.DIR.UNIBO.IT .studenti.dir.unibo.it=STUDENTI.DIR.UNIBO.IT studenti.dir.unibo.it=STUDENTI.DIR.UNIBO.IT"

# ==========================================
# SSSD SPECIFIC CONFIGURATION
# ==========================================
DEFAULT_FALLBACK_HOMEDIR_TEMPLATE="/nfs/home/%U"
DEFAULT_USE_FQNS="false"
DEFAULT_AD_GPO_MAP_SERVICE="+rstudio, +nginx"

# ==========================================
# SAMBA / WINBIND CONFIGURATION
# ==========================================
DEFAULT_SAMBA_SMB_CONF_PATH="/etc/samba/smb.conf"
DEFAULT_SAMBA_LOG_LEVEL=1
DEFAULT_SAMBA_MAX_LOG_SIZE=50
USE_WINBIND=true
DEFAULT_MEMBERSHIP_SOFTWARE="samba"
DEFAULT_CLIENT_SOFTWARE="winbind"

# --- ID Mapping Ranges ---
DEFAULT_IDMAP_PERSONALE_RANGE_LOW=163600000
DEFAULT_IDMAP_PERSONALE_RANGE_HIGH=263600000
DEFAULT_IDMAP_STAR_RANGE_LOW=10000
DEFAULT_IDMAP_STAR_RANGE_HIGH=999999
DEFAULT_IDMAP_BACKEND_DOMAIN="PERSONALE" # Usually matches WORKGROUP

# --- Access Control Patterns ---
# Note: Use single quotes if possible, but .env parsers vary. 
# We maintain the escaped quotes format for compatibility with the script's expectations.
DEFAULT_VALID_USERS_PATTERN='+PERSONALE\STR968-Informatica +PERSONALE\Str00968-lifewatch +PERSONALE\Str00968-calc'
DEFAULT_INVALID_USERS_PATTERN='+PERSONALE\"Domain Users"'
# SSSD Compatibility Mode (Hybrid Setup)
DEFAULT_SSSD_COMPAT="false"

# ==========================================
# SECURE ACCESS SERVICES (Web Terminal / File Browser)
# ==========================================
WEB_TERMINAL_PORT="2222"
# FILEBROWSER_PORT="2223"
NEXTCLOUD_TARGET_URL="https://192.168.1.100"

# ==========================================
# 12. PKI & Trust (Internal Step-CA)
# ==========================================
# URL of the Step-CA server
# Example: https://ca.example.com:9000
STEP_CA_URL=

# SHA256 Fingerprint of the Root CA
STEP_FINGERPRINT=

# One-time Enrollment Token (Generate on CA via generate_token.sh)
# Required for initial Nginx certificate enrollment.
STEP_TOKEN=
