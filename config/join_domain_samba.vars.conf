#!/bin/bash
# conf/samba_kerberos_setup.vars.conf
# Configuration variables for the Samba + Kerberos (Winbind) setup script.
# These settings are specific to Samba/Winbind domain membership.

# =============================================================================
# Source Common AD/Kerberos Configuration
# =============================================================================
# Most domain, OU, and NTP settings are centralized in kerberos_setup.vars.conf
# to avoid duplication. Edit that file to change common settings.

# Determine config directory for sourcing
_CONF_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" &>/dev/null && pwd)"

if [[ -f "${_CONF_DIR}/lib_kerberos_setup.vars.conf" ]]; then
    # shellcheck source=lib_kerberos_setup.vars.conf
    source "${_CONF_DIR}/lib_kerberos_setup.vars.conf"
elif [[ -f "${SCRIPT_DIR}/../config/lib_kerberos_setup.vars.conf" ]]; then
    source "${SCRIPT_DIR}/../config/lib_kerberos_setup.vars.conf"
fi

# =============================================================================
# SAMBA/WINBIND-SPECIFIC SETTINGS
# =============================================================================
# These settings are unique to Samba or override common defaults.

## -----------------------------------------------------------------------------
## Samba Configuration Paths
## -----------------------------------------------------------------------------

# Where to write the generated smb.conf (can be overridden by script args)
DEFAULT_SAMBA_SMB_CONF_PATH="/etc/samba/smb.conf"

## -----------------------------------------------------------------------------
## ID Mapping Ranges
## -----------------------------------------------------------------------------
# These ranges are used for mapping AD users/groups to local UIDs/GIDs.
# Ensure ranges don't overlap with local users or other idmap backends.

DEFAULT_IDMAP_PERSONALE_RANGE_LOW=163600000
DEFAULT_IDMAP_PERSONALE_RANGE_HIGH=263600000
DEFAULT_IDMAP_STAR_RANGE_LOW=10000
DEFAULT_IDMAP_STAR_RANGE_HIGH=999999

## -----------------------------------------------------------------------------
## Samba Home Directory Template
## -----------------------------------------------------------------------------
# Samba uses %U for username in template homedir
# Falls back to common DEFAULT_HOME_TEMPLATE if not set
DEFAULT_TEMPLATE_HOMEDIR="${DEFAULT_HOME_TEMPLATE:-/nfs/home/%U}"

## -----------------------------------------------------------------------------
## Domain/Realm Names for smb.conf
## -----------------------------------------------------------------------------
# These are derived from the common settings but can be overridden here
DEFAULT_REALM="${DEFAULT_AD_DOMAIN_UPPER:-PERSONALE.DIR.UNIBO.IT}"
DEFAULT_WORKGROUP="${DEFAULT_AD_DOMAIN_UPPER%%.*}"  # Extract first part (PERSONALE)

## -----------------------------------------------------------------------------
## SSSD Compatibility Mode
## -----------------------------------------------------------------------------
# Whether to enable idmap compat with sssd (for hybrid setups)
DEFAULT_SSSD_COMPAT="false"

## -----------------------------------------------------------------------------
## Samba Logging Configuration
## -----------------------------------------------------------------------------
DEFAULT_SAMBA_LOG_LEVEL=1
DEFAULT_SAMBA_MAX_LOG_SIZE=50

## -----------------------------------------------------------------------------
## Realm Join Command Defaults
## -----------------------------------------------------------------------------
DEFAULT_MEMBERSHIP_SOFTWARE="samba"
DEFAULT_CLIENT_SOFTWARE="winbind"

# When true, script will pre-install Samba + Winbind and prefer the winbind
# membership path (useful when you want to join via 'net ads' / Samba stack).
USE_WINBIND=true

## -----------------------------------------------------------------------------
## Template Placeholders (Generic)
## -----------------------------------------------------------------------------
# Backend domain for IDMAP config (replaces %%IDMAP_BACKEND_DOMAIN%%)
DEFAULT_IDMAP_BACKEND_DOMAIN="${DEFAULT_WORKGROUP:-PERSONALE}"

# Valid users pattern for [homes] (replaces %%VALID_USERS_PATTERN%%)
DEFAULT_VALID_USERS_PATTERN="%S"
